{% comment %}
  Video Gallery Section
  Displays a collection of videos with thumbnails
{% endcomment %}

<div class="video-gallery section color-{{ section.settings.color_scheme }}">
  <div class="video-gallery__container page-width">
    {%- if section.settings.heading != blank -%}
      <div class="video-gallery__header section__header">
        <h2 class="video-gallery__heading section__heading">{{ section.settings.heading }}</h2>
        {%- if section.settings.subheading != blank -%}
          <p class="video-gallery__subheading section__subheading">{{ section.settings.subheading }}</p>
        {%- endif -%}
      </div>
    {%- endif -%}

    <div class="video-gallery__grid grid grid-{{ section.settings.columns_desktop }}">
      {%- for block in section.blocks -%}
        <div class="video-gallery__item" {{ block.shopify_attributes }}>
          <div class="video-card">
            {%- if block.settings.video_url != blank -%}
              <div class="video-card__wrapper">
                {%- if block.settings.cover_image != blank -%}
                  <img
                    src="{{ block.settings.cover_image | image_url: width: 800 }}"
                    alt="{{ block.settings.title | escape }}"
                    class="video-card__thumbnail"
                    loading="lazy"
                  >
                  <button 
                    class="video-card__play-button"
                    data-video-url="{{ block.settings.video_url }}"
                    aria-label="Play video"
                  >
                    <i class="fa-solid fa-play"></i>
                  </button>
                {%- else -%}
                  <div class="video-card__embed">
                    {%- if block.settings.video_url contains 'youtube.com' or block.settings.video_url contains 'youtu.be' -%}
                      {%- assign video_id = block.settings.video_url | split: 'v=' | last | split: '/' | last | split: '&' | first -%}
                      <iframe
                        src="https://www.youtube.com/embed/{{ video_id }}"
                        frameborder="0"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                        allowfullscreen
                        class="video-card__iframe"
                      ></iframe>
                    {%- elsif block.settings.video_url contains 'vimeo.com' -%}
                      {%- assign video_id = block.settings.video_url | split: '/' | last -%}
                      <iframe
                        src="https://player.vimeo.com/video/{{ video_id }}"
                        frameborder="0"
                        allow="autoplay; fullscreen; picture-in-picture"
                        allowfullscreen
                        class="video-card__iframe"
                      ></iframe>
                    {%- endif -%}
                  </div>
                {%- endif -%}
              </div>
            {%- endif -%}

            <div class="video-card__content">
              {%- if block.settings.title != blank -%}
                <h3 class="video-card__title">{{ block.settings.title }}</h3>
              {%- endif -%}
              {%- if block.settings.description != blank -%}
                <p class="video-card__description">{{ block.settings.description }}</p>
              {%- endif -%}
            </div>
          </div>
        </div>
      {%- endfor -%}
    </div>
  </div>
</div>

<!-- Video Modal -->
<div id="video-modal" class="video-modal" style="display: none;">
  <div class="video-modal__overlay"></div>
  <div class="video-modal__content">
    <button class="video-modal__close" aria-label="Close video">
      <i class="fa-solid fa-xmark"></i>
    </button>
    <div class="video-modal__wrapper">
      <div id="video-modal-player"></div>
    </div>
  </div>
</div>

<style>
  .video-gallery {
    padding: var(--space-16) 0;
  }

  .video-gallery__header {
    text-align: center;
    margin-bottom: var(--space-12);
  }

  .video-gallery__heading {
    font-family: var(--font-heading);
    font-size: 2.5rem;
    color: var(--gray-900);
    margin-bottom: var(--space-4);
  }

  .video-gallery__subheading {
    font-size: 1.125rem;
    color: var(--gray-700);
    max-width: 600px;
    margin: 0 auto;
  }

  .video-gallery__grid {
    display: grid;
    gap: var(--space-6);
  }

  @media screen and (max-width: 749px) {
    .video-gallery__grid {
      grid-template-columns: 1fr;
    }
  }

  @media screen and (min-width: 750px) and (max-width: 989px) {
    .video-gallery__grid.grid-2,
    .video-gallery__grid.grid-3 {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media screen and (min-width: 990px) {
    .video-gallery__grid.grid-2 {
      grid-template-columns: repeat(2, 1fr);
    }
    .video-gallery__grid.grid-3 {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  .video-card {
    background: var(--white);
    border-radius: var(--radius-lg);
    overflow: hidden;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
    transition: all 0.3s ease;
    border: 1px solid rgba(0, 0, 0, 0.06);
  }

  .video-card:hover {
    box-shadow: 0 12px 32px rgba(0, 0, 0, 0.18);
    transform: translateY(-8px);
    border-color: var(--purple-500);
  }

  .video-card__wrapper {
    position: relative;
    padding-bottom: 56.25%; /* 16:9 aspect ratio */
    background: var(--dark-900);
  }

  .video-card__thumbnail {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .video-card__play-button {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: var(--purple-500);
    border: none;
    color: var(--white);
    font-size: 1.5rem;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    padding-left: 4px;
  }

  .video-card__play-button:hover {
    background: var(--purple-600);
    transform: translate(-50%, -50%) scale(1.1);
  }

  .video-card__embed {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
  }

  .video-card__iframe {
    width: 100%;
    height: 100%;
  }

  .video-card__content {
    padding: 24px;
  }

  .video-card__title {
    font-family: var(--font-heading);
    font-size: 1.375rem;
    color: var(--gray-900);
    margin-bottom: 12px;
    font-weight: 600;
    line-height: 1.3;
  }

  .video-card__description {
    font-size: 1rem;
    color: var(--gray-700);
    line-height: 1.6;
  }

  /* Video Modal */
  .video-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 9999;
  }

  .video-modal__overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.9);
  }

  .video-modal__content {
    position: relative;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: var(--space-8);
  }

  .video-modal__close {
    position: absolute;
    top: var(--space-4);
    right: var(--space-4);
    width: 48px;
    height: 48px;
    border-radius: 50%;
    background: var(--white);
    border: none;
    color: var(--gray-900);
    font-size: 1.5rem;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10000;
  }

  .video-modal__close:hover {
    background: var(--purple-500);
    color: var(--white);
  }

  .video-modal__wrapper {
    width: 100%;
    max-width: 1200px;
    position: relative;
    padding-bottom: 56.25%;
  }

  #video-modal-player {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
  }
</style>

<script>
  // Video modal functionality
  document.addEventListener('DOMContentLoaded', function() {
    const modal = document.getElementById('video-modal');
    const modalPlayer = document.getElementById('video-modal-player');
    const closeBtn = document.querySelector('.video-modal__close');
    const overlay = document.querySelector('.video-modal__overlay');
    const playButtons = document.querySelectorAll('.video-card__play-button');

    playButtons.forEach(button => {
      button.addEventListener('click', function() {
        const videoUrl = this.getAttribute('data-video-url');
        let embedUrl = '';

        if (videoUrl.includes('youtube.com') || videoUrl.includes('youtu.be')) {
          const videoId = videoUrl.split('v=')[1]?.split('&')[0] || videoUrl.split('/').pop();
          embedUrl = `https://www.youtube.com/embed/${videoId}?autoplay=1`;
        } else if (videoUrl.includes('vimeo.com')) {
          const videoId = videoUrl.split('/').pop();
          embedUrl = `https://player.vimeo.com/video/${videoId}?autoplay=1`;
        }

        if (embedUrl) {
          modalPlayer.innerHTML = `<iframe src="${embedUrl}" frameborder="0" allow="autoplay; fullscreen" allowfullscreen style="width: 100%; height: 100%;"></iframe>`;
          modal.style.display = 'block';
          document.body.style.overflow = 'hidden';
        }
      });
    });

    function closeModal() {
      modal.style.display = 'none';
      modalPlayer.innerHTML = '';
      document.body.style.overflow = '';
    }

    closeBtn.addEventListener('click', closeModal);
    overlay.addEventListener('click', closeModal);

    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        closeModal();
      }
    });
  });
</script>

{% schema %}
{
  "name": "Video Gallery",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Watch Our Videos"
    },
    {
      "type": "textarea",
      "id": "subheading",
      "label": "Subheading",
      "default": "Catch up on the latest content"
    },
    {
      "type": "select",
      "id": "columns_desktop",
      "label": "Desktop columns",
      "options": [
        {
          "value": "2",
          "label": "2 columns"
        },
        {
          "value": "3",
          "label": "3 columns"
        }
      ],
      "default": "3"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme-1"
    }
  ],
  "blocks": [
    {
      "type": "video",
      "name": "Video",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Video title",
          "default": "Video Title"
        },
        {
          "type": "textarea",
          "id": "description",
          "label": "Video description"
        },
        {
          "type": "url",
          "id": "video_url",
          "label": "Video URL",
          "info": "YouTube or Vimeo URL"
        },
        {
          "type": "image_picker",
          "id": "cover_image",
          "label": "Cover image",
          "info": "Optional. If not provided, video will embed directly."
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Video Gallery",
      "blocks": [
        {
          "type": "video",
          "settings": {
            "title": "Featured Video",
            "description": "Check out our latest content"
          }
        },
        {
          "type": "video",
          "settings": {
            "title": "Behind the Scenes",
            "description": "See how we create our content"
          }
        },
        {
          "type": "video",
          "settings": {
            "title": "Tutorial",
            "description": "Learn something new"
          }
        }
      ]
    }
  ]
}
{% endschema %}
